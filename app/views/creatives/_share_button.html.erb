<button id="share-creative-btn" class="btn btn-primary"><%= t('creatives.index.share') %></button>
<!-- Share Creative Modal -->
<div id="share-creative-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1000;align-items:center;justify-content:center;">
  <div style="background: var(--color-bg);padding:2em;border-radius:8px;min-width:320px;max-width:90vw;position:relative;">
    <button id="close-share-modal" style="position:absolute;top:0.5em;right:0.5em;">&times;</button>
    <h2><%= t('creatives.index.share_creative') %></h2>
    <% shared_creative = @parent_creative || @creative %>
    <% shared_list = CreativeShare.where(creative: shared_creative).includes(:user) %>
    <% if shared_list.any? %>
      <div style="margin-bottom:1em;">
        <strong><%= t('creatives.index.shared_with') %>:</strong>
        <ul style="padding-left:1.5em;">
          <% shared_list.each do |share| %>
            <li>
              <%= share.user&.email_address || t('creatives.index.unknown_user') %> - <%= t(".permission_#{share.permission}") %>
            </li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <form id="share-creative-form" action="<%= creative_creative_shares_path(@parent_creative || @creative) %>" method="post">
      <%= csrf_meta_tags %>
      <div style="margin-bottom:1em;">
        <label for="share-user-email"><%= t('creatives.index.user_email') %></label>
        <input type="email" name="user_email" id="share-user-email" required style="width:100%;" />
      </div>
      <div style="margin-bottom:1em;">
        <label for="share-permission"><%= t('creatives.index.permission') %></label>
        <select name="permission" id="share-permission" style="width:100%;">
          <option value="read"><%= t('creatives.index.permission_read') %></option>
          <option value="read_tree"><%= t('creatives.index.permission_read_tree') %></option>
          <option value="write"><%= t('creatives.index.permission_write') %></option>
          <option value="write_tree"><%= t('creatives.index.permission_write_tree') %></option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary"><%= t('creatives.index.share') %></button>
    </form>
  </div>
</div>
<script>
    document.addEventListener('turbo:load', function() {
        const shareBtn = document.getElementById('share-creative-btn');
        const modal = document.getElementById('share-creative-modal');
        const closeBtn = document.getElementById('close-share-modal');
        if (shareBtn && modal && closeBtn) {
            shareBtn.onclick = function() { modal.style.display = 'flex'; };
            closeBtn.onclick = function() { modal.style.display = 'none'; };
            modal.onclick = function(e) { if (e.target === modal) modal.style.display = 'none'; };
        }
    });
</script>