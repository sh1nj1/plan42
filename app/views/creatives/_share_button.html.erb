<%= stylesheet_link_tag 'popup', media: 'all' %>
<button id="share-creative-btn" class="btn btn-primary"><%= t('creatives.index.share') %></button>
<!-- Share Creative Modal -->
<div id="share-creative-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1000;align-items:center;justify-content:center;">
  <div class="popup-box" style="min-width:320px;max-width:90vw;">
    <button id="close-share-modal" class="popup-close-btn">&times;</button>
    <h2><%= t('creatives.index.share_creative') %></h2>
    <% if @shared_list.any? %>
      <div style="margin-bottom:1em;">
        <strong><%= t('creatives.index.shared_with') %>:</strong>
        <ul style="padding-left:1.5em;">
          <% @shared_list.each do |share| %>
            <li>
              <%= share.user&.email || t('creatives.index.unknown_user') %> - <%= t(".permission_#{share.permission}") %>
              <%= button_to 'Ã—', creative_creative_share_path(@parent_creative || @creative, share), method: :delete, form: { data: { turbo_confirm: t('creatives.index.are_you_sure_delete_share') } }, class: 'delete-share-btn', style: 'margin-left:0.5em;padding:0 0.5em;' %>
            </li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <form id="share-creative-form" action="<%= creative_creative_shares_path(@parent_creative || @creative) %>" method="post" data-controller="share-invite">
      <%= csrf_meta_tags %>
      <div style="margin-bottom:1em;">
        <label for="share-user-email"><%= t('creatives.index.user_email') %></label>
        <input type="email" name="user_email" id="share-user-email" required style="width:100%;" data-share-invite-target="email" data-action="blur->share-invite#check" />
      </div>
      <div style="margin-bottom:1em;">
        <label for="share-permission"><%= t('creatives.index.permission') %></label>
        <select name="permission" id="share-permission" style="width:100%;">
          <option value="read"><%= t('creatives.index.permission_read') %></option>
          <option value="feedback"><%= t('creatives.index.permission_feedback') %></option>
          <option value="write"><%= t('creatives.index.permission_write') %></option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary" data-share-invite-target="submit" data-share="<%= t('creatives.index.share') %>" data-invite="<%= t('creatives.index.invite') %>"><%= t('creatives.index.share') %></button>
    </form>
  </div>
</div>
<script>
    document.addEventListener('turbo:load', function() {
        const shareBtn = document.getElementById('share-creative-btn');
        const modal = document.getElementById('share-creative-modal');
        const closeBtn = document.getElementById('close-share-modal');
        if (shareBtn && modal && closeBtn) {
            shareBtn.onclick = function() { modal.style.display = 'flex'; };
            closeBtn.onclick = function() { modal.style.display = 'none'; };
            modal.onclick = function(e) { if (e.target === modal) modal.style.display = 'none'; };
        }
    });
</script>
