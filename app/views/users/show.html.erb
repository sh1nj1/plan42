<div data-controller="avatar-preview">
  <h1 class="no-top-margin"><%= t('users.details') %></h1>

  <div class="avatar-preview-row">
    <div class="avatar-preview-pane">
      <span class="avatar-preview-label"><%= t('users.current_avatar') %></span>
      <%= render AvatarComponent.new(user: @user, size: 80, classes: 'avatar') %>
    </div>

    <div class="avatar-preview-pane" data-avatar-preview-target="previewContainer">
      <span class="avatar-preview-label"><%= t('users.new_avatar_preview') %></span>
      <div class="avatar-preview-frame">
        <%= image_tag '',
            alt: t('users.new_avatar_preview'),
            class: 'avatar-preview-image avatar-preview-hidden',
            data: { avatar_preview_target: 'previewImage' } %>
        <div class="avatar-preview-placeholder" data-avatar-preview-target="placeholder">
          <%= t('users.avatar_preview_placeholder') %>
        </div>
      </div>
    </div>
  </div>

  <%= form_with model: @user, url: user_path(@user), method: :patch, local: true, html: { multipart: true, class: 'profile-form' } do |f| %>
    <div>
      <%= f.label :avatar, t('users.avatar') %>
      <%= f.file_field :avatar, data: { avatar_preview_target: 'input', action: 'avatar-preview#update' } %>
    </div>
    <div>
      <%= f.label :name, t('users.name') %>
      <%= f.text_field :name, required: true %>
    </div>
    <div>
      <%= f.label :email, t('users.email') %>
      <%= f.text_field :email, required: true, disabled: true %>
    </div>
    <div>
      <%= f.label :avatar_url, t('users.avatar_url') %>
      <%= f.text_field :avatar_url, placeholder: t('users.avatar_url') %>
    </div>
    <div>
      <%= f.label :display_level, t('users.display_level') %>
      <%= f.number_field :display_level, min: 1 %>
    </div>
    <div>
      <%= f.label :completion_mark, t('users.completion_mark') %>
      <%= f.text_field :completion_mark %>
    </div>
    <div>
      <%= f.label :theme, t('users.theme') %>
      <%= f.select :theme, options_for_select([[t('app.system_mode'), nil], [t('app.light_mode'), 'light'], [t('app.dark_mode'), 'dark']], @user.theme) %>
    </div>
    <div>
      <%= f.label :calendar_id, t('users.calendar_id') %>
      <%= f.text_field :calendar_id, placeholder: t('users.calendar_id') %>
    </div>
    <div class="checkbox-field">
      <%= f.check_box :notifications_enabled %>
      <%= f.label :notifications_enabled, t('users.notifications_enabled') %>
    </div>
    <div>
      <%= f.label :locale, t('users.locale') %>
      <%= f.select :locale, I18n.available_locales.map { |loc| [t("users.locales.#{loc}"), loc] } %>
    </div>
    <div>
      <%= f.label :timezone, t('users.timezone') %>
      <%= f.select :timezone, ActiveSupport::TimeZone.all.map { |tz| [tz.to_s, tz.tzinfo.name] } %>
    </div>
    <%= f.submit t('users.update_profile') %>
  <% end %>

  <%= link_to t('users.change_password'), edit_password_user_path %>
</div>
