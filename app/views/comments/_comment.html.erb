<div class="comment-item <%= 'last-read' if defined?(last_read_comment_id) && last_read_comment_id && comment.id == last_read_comment_id %>" id="<%= dom_id(comment) %>" data-controller="comment" data-user-id="<%= comment.user&.id %>">
  <div>
    <%= render AvatarComponent.new(user: comment.user, size: 20, classes: 'avatar comment-avatar') %>
    <% system_prefix = "#{t('comments.system_user')}:" %>
    <% display_name =
         if comment.user.present?
           comment.user.display_name
         elsif comment.content.to_s.strip.start_with?(system_prefix)
           t('comments.system_user')
         else
           t('comments.gemini')
         end %>
    <% timestamp = comment.created_at.in_time_zone %>
    <strong><%= display_name %></strong>
    <span>
      Â· <%= content_tag(
        :time,
        t('datetime.ago', time: time_ago_in_words(timestamp)),
        title: l(timestamp, format: :chat_timestamp),
        datetime: timestamp.iso8601
      ) %>
    </span>
    <% if comment.private? %>
      <span class="private-label">[<%= t('comments.private') %>]</span>
    <% end %>
    <div class="comment-action-container" data-comment-target="actions" style="display: none;">
      <button class="convert-comment-btn" data-comment-id="<%= comment.id %>" title="<%= t('comments.convert_to_creative') %>">
        <%= t('comments.convert_button') %>
      </button>
      <button class="edit-comment-btn" data-comment-id="<%= comment.id %>" data-comment-content="<%= comment.content %>" data-comment-private="<%= comment.private? %>" title="<%= t('comments.update_comment') %>">
        <%= t('comments.edit_button') %>
      </button>
      <button class="delete-comment-btn" data-comment-id="<%= comment.id %>" title="<%= t('comments.delete') %>">
        <%= t('comments.delete_button') %>
      </button>
    </div>
  </div>
  <div class="comment-content"><%= comment.content %></div>
</div>
