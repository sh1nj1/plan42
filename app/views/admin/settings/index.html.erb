<h1 class="no-top-margin"><%= t('admin.title') %></h1>

<%= render "admin/shared/tabs" %>
<div class="tab-panels">
  <section class="tab-panel active">
    <%= form_with url: admin_settings_path, method: :patch, local: true, html: { class: 'profile-form' } do |f| %>
      <div>
        <%= f.label :help_link, t('admin.settings.help_link') %>
        <%= f.text_field :help_link, value: @help_link, placeholder: "https://..." %>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
          <%= t('admin.settings.help_link_hint') %>
        </div>
      </div>

      <div style="margin-top: 1.5em;">
        <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5em;">
          <%= f.check_box :mcp_tool_approval, checked: @mcp_tool_approval %>
          <span><%= t('admin.settings.mcp_tool_approval') %></span>
        </label>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em; margin-left: 1.8em;">
          <%= t('admin.settings.mcp_tool_approval_hint') %>
        </div>
      </div>

      <div style="margin-top: 2em; border-top: 1px solid var(--color-border); padding-top: 1.5em;">
        <h3 style="font-size: 1.1em; margin-bottom: 1em;"><%= t('admin.settings.account_lockout') %></h3>
        <div style="display: flex; gap: 2em; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 200px;">
            <%= f.label :max_login_attempts, t('admin.settings.max_login_attempts') %>
            <%= f.number_field :max_login_attempts, value: @max_login_attempts, min: 1, max: 100, style: "width: 100%;" %>
            <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
              <%= t('admin.settings.max_login_attempts_hint') %>
            </div>
          </div>
          <div style="flex: 1; min-width: 200px;">
            <%= f.label :lockout_duration_minutes, t('admin.settings.lockout_duration_minutes') %>
            <%= f.number_field :lockout_duration_minutes, value: @lockout_duration_minutes, min: 1, max: 1440, style: "width: 100%;" %>
            <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
              <%= t('admin.settings.lockout_duration_minutes_hint') %>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top: 2em; border-top: 1px solid var(--color-border); padding-top: 1.5em;">
        <h3 style="font-size: 1.1em; margin-bottom: 1em;"><%= t('admin.settings.auth_providers') %></h3>
        <div style="display: flex; flex-direction: column; gap: 0.8em;">
          <% Rails.application.config.auth_providers.sort_by { |p| p[:priority] }.each do |provider| %>
            <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5em;">
              <%= check_box_tag "auth_providers[]", provider[:key], @enabled_auth_providers.include?(provider[:key].to_s), id: "auth_provider_#{provider[:key]}" %>
              <span><%= t(provider[:name], default: provider[:name].to_s.humanize) %></span>
            </label>
          <% end %>
        </div>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.5em;">
          <%= t('admin.settings.auth_providers_hint', default: "Select allowed authentication methods. Warning: Disabling all may lock you out.") %>
        </div>
      </div>

      <%= f.submit t('admin.settings.save') %>
    <% end %>
  </section>
</div>
