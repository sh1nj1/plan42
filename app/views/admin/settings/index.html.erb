<h1 class="no-top-margin"><%= t('admin.title') %></h1>

<%= render "admin/shared/tabs" %>
<div class="tab-panels">
  <section class="tab-panel active">
    <%= tag.div(flash[:alert], class: "flash-alert") if flash[:alert] %>
    <%= form_with url: admin_settings_path, method: :patch, local: true, html: { class: 'profile-form' } do |f| %>
      <div>
        <%= f.label :help_link, t('admin.settings.help_link') %>
        <%= f.text_field :help_link, value: @help_link, placeholder: "https://..." %>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
          <%= t('admin.settings.help_link_hint') %>
        </div>
      </div>

      <div style="margin-top: 1.5em;">
        <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5em;">
          <%= f.check_box :mcp_tool_approval, checked: @mcp_tool_approval %>
          <span><%= t('admin.settings.mcp_tool_approval') %></span>
        </label>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em; margin-left: 1.8em;">
          <%= t('admin.settings.mcp_tool_approval_hint') %>
        </div>
      </div>

      <div style="margin-top: 1.5em;">
        <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5em;">
          <%= f.check_box :creatives_login_required, checked: @creatives_login_required %>
          <span><%= t('admin.settings.creatives_login_required') %></span>
        </label>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em; margin-left: 1.8em;">
          <%= t('admin.settings.creatives_login_required_hint') %>
        </div>
      </div>

      <div style="margin-top: 1.5em;">
        <%= f.label :home_page_path, t('admin.settings.home_page_path') %>
        <%= f.text_field :home_page_path, value: @home_page_path, placeholder: "/" %>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
          <%= t('admin.settings.home_page_path_hint') %>
        </div>
      </div>

      <div style="margin-top: 2em; border-top: 1px solid var(--color-border); padding-top: 1.5em;">
        <h3 style="font-size: 1.1em; margin-bottom: 1em;"><%= t('admin.settings.account_lockout') %></h3>
        <div style="display: flex; gap: 2em; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 200px;">
            <%= f.label :max_login_attempts, t('admin.settings.max_login_attempts') %>
            <%= f.number_field :max_login_attempts, value: @max_login_attempts, min: 1, max: 100, style: "width: 100%;" %>
            <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
              <%= t('admin.settings.max_login_attempts_hint') %>
            </div>
          </div>
          <div style="flex: 1; min-width: 200px;">
            <%= f.label :lockout_duration_minutes, t('admin.settings.lockout_duration_minutes') %>
            <%= f.number_field :lockout_duration_minutes, value: @lockout_duration_minutes, min: 1, max: 1440, style: "width: 100%;" %>
            <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
              <%= t('admin.settings.lockout_duration_minutes_hint') %>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top: 2em; border-top: 1px solid var(--color-border); padding-top: 1.5em;">
        <h3 style="font-size: 1.1em; margin-bottom: 1em;"><%= t('admin.settings.password_policy') %></h3>
        <div style="max-width: 300px;">
          <%= f.label :password_min_length, t('admin.settings.password_min_length') %>
          <%= f.number_field :password_min_length, value: @password_min_length, min: SystemSetting::DEFAULT_PASSWORD_MIN_LENGTH, max: 72, style: "width: 100%;" %>
          <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
            <%= t('admin.settings.password_min_length_hint') %>
          </div>
        </div>
      </div>

      <div style="margin-top: 2em; border-top: 1px solid var(--color-border); padding-top: 1.5em;">
        <h3 style="font-size: 1.1em; margin-bottom: 1em;"><%= t('admin.settings.session_timeout') %></h3>
        <div style="max-width: 300px;">
          <%= f.label :session_timeout_minutes, t('admin.settings.session_timeout_minutes') %>
          <%= f.number_field :session_timeout_minutes, value: @session_timeout_minutes, min: 0, max: 10080, style: "width: 100%;" %>
          <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
            <%= t('admin.settings.session_timeout_minutes_hint') %>
          </div>
        </div>
      </div>

      <div style="margin-top: 2em; border-top: 1px solid var(--color-border); padding-top: 1.5em;">
        <h3 style="font-size: 1.1em; margin-bottom: 1em;"><%= t('admin.settings.rate_limiting') %></h3>

        <div style="margin-bottom: 1.5em;">
          <h4 style="font-size: 1em; margin-bottom: 0.75em; color: var(--color-text-muted);"><%= t('admin.settings.password_reset_rate') %></h4>
          <div style="display: flex; gap: 2em; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
              <%= f.label :password_reset_rate_limit, t('admin.settings.rate_limit_requests') %>
              <%= f.number_field :password_reset_rate_limit, value: @password_reset_rate_limit, min: 1, max: 1000, style: "width: 100%;" %>
            </div>
            <div style="flex: 1; min-width: 200px;">
              <%= f.label :password_reset_rate_period_minutes, t('admin.settings.rate_limit_period_minutes') %>
              <%= f.number_field :password_reset_rate_period_minutes, value: @password_reset_rate_period_minutes, min: 1, max: 1440, style: "width: 100%;" %>
            </div>
          </div>
          <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
            <%= t('admin.settings.password_reset_rate_hint') %>
          </div>
        </div>

        <div>
          <h4 style="font-size: 1em; margin-bottom: 0.75em; color: var(--color-text-muted);"><%= t('admin.settings.api_rate') %></h4>
          <div style="display: flex; gap: 2em; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
              <%= f.label :api_rate_limit, t('admin.settings.rate_limit_requests') %>
              <%= f.number_field :api_rate_limit, value: @api_rate_limit, min: 1, max: 10000, style: "width: 100%;" %>
            </div>
            <div style="flex: 1; min-width: 200px;">
              <%= f.label :api_rate_period_minutes, t('admin.settings.rate_limit_period_minutes') %>
              <%= f.number_field :api_rate_period_minutes, value: @api_rate_period_minutes, min: 1, max: 60, style: "width: 100%;" %>
            </div>
          </div>
          <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.25em;">
            <%= t('admin.settings.api_rate_hint') %>
          </div>
        </div>
      </div>

      <div style="margin-top: 2em; border-top: 1px solid var(--color-border); padding-top: 1.5em;">
        <h3 style="font-size: 1.1em; margin-bottom: 1em;"><%= t('admin.settings.auth_providers') %></h3>
        <div style="display: flex; flex-direction: column; gap: 0.8em;">
          <% Rails.application.config.auth_providers.sort_by { |p| p[:priority] }.each do |provider| %>
            <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5em;">
              <%= check_box_tag "auth_providers[]", provider[:key], @enabled_auth_providers.include?(provider[:key].to_s), id: "auth_provider_#{provider[:key]}" %>
              <span><%= t(provider[:name], default: provider[:name].to_s.humanize) %></span>
            </label>
          <% end %>
        </div>
        <div class="help-text" style="font-size: 0.85em; color: var(--color-text-muted); margin-top: 0.5em;">
          <%= t('admin.settings.auth_providers_hint', default: "Select allowed authentication methods. Warning: Disabling all may lock you out.") %>
        </div>
      </div>

      <%= f.submit t('admin.settings.save') %>
    <% end %>
  </section>
</div>
