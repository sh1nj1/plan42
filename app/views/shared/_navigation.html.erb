<nav>
  <form action="<%= main_app.creatives_path %>" method="get">
    <% if params[:id].present? %>
      <input type="hidden" name="id" value="<%= params[:id] %>" />
    <% end %>
    <input type="text" id="search" class="shared-input-surface" name="search" value="<%= params[:search] %>" placeholder="<%= t('app.search_placeholder') %>" />
  </form>
  <% if authenticated? %>
    <button class="plans-menu-btn mobile-only" type="button"><%= t('app.plans') %></button>
  <% end %>

  <div class="desktop-only">
    <%= button_to t('app.home'), main_app.root_path, method: :get %>
    <% if authenticated? %>
      <form id="button_to">
        <button id="plans-menu-btn" class="plans-menu-btn" type="button"><%= t('app.plans') %></button>
      </form>
      <% progress_state = if params[:min_progress] == '1' && params[:max_progress] == '1'
                            :complete
                          elsif params[:min_progress] == '0' && params[:max_progress] == '0.99'
                            :incomplete
                          else
                            :all
                          end %>
      <% comment_state = params[:comment] == 'true' ? :comment : nil %>
      <%= render ProgressFilterComponent.new(
            current_state: progress_state,
            states: [
              { name: t('app.filter_complete'), value: :complete },
              { name: t('app.filter_incomplete'), value: :incomplete },
              { name: t('app.filter_all'), value: :all }
            ]
          ) %>
      <%= render ProgressFilterComponent.new(
            current_state: comment_state,
            states: [
              { name: t('app.filter_comments'), value: :comment }
            ]
          ) %>
    <% end %>
    <% if Current.user %>
      <form id="inbox_button_to">
        <button id="inbox-menu-btn" class="inbox-menu-btn" type="button"><%= t('app.inbox') %><%= render Inbox::BadgeComponent.new(user: Current.user, badge_id: 'desktop-inbox-badge') %></button>
      </form>
    <% end %>
    <%= button_to t('app.sign_in'), main_app.new_session_path, method: :get unless authenticated? %>
    <%= button_tag "?", id: "creative-guide-link", class: "creative-guide-link", data: { help_url: SystemSetting.help_menu_link } %>
  </div>

  <%= render PopupMenuComponent.new(
        button_content: safe_join(['...', (render(Inbox::BadgeComponent.new(user: Current.user, badge_id: 'mobile-inbox-badge')) if Current.user)]),
        button_classes: 'mobile-only',
        menu_id: 'mobile-more-menu',
        align: :right
      ) do %>
    <div><%= button_to t('app.home'), main_app.root_path, method: :get %></div>
    <% if authenticated? %>
      <% progress_state = if params[:min_progress] == '1' && params[:max_progress] == '1'
                            :complete
                          elsif params[:min_progress] == '0' && params[:max_progress] == '0.99'
                            :incomplete
                          else
                            :all
                          end %>
      <% comment_state = params[:comment] == 'true' ? :comment : nil %>
      <%= render ProgressFilterComponent.new(
            current_state: progress_state,
            states: [
              { name: t('app.filter_complete'), value: :complete },
              { name: t('app.filter_incomplete'), value: :incomplete },
              { name: t('app.filter_all'), value: :all }
            ]
          ) %>
      <%= render ProgressFilterComponent.new(
            current_state: comment_state,
            states: [
              { name: t('app.filter_comments'), value: :comment }
            ]
          ) %>
    <% end %>
    <% if Current.user %>
      <div>
        <button class="inbox-menu-btn" type="button"><%= t('app.inbox') %><%= render Inbox::BadgeComponent.new(user: Current.user, badge_id: 'mobile-inbox-badge') %></button>
      </div>
    <% end %>
    <div><%= button_to t('app.sign_in'), main_app.new_session_path, method: :get unless authenticated? %></div>
    <div><%= button_tag "?", id: "creative-guide-link", class: "creative-guide-link", data: { help_url: SystemSetting.help_menu_link } %></div>
  <% end %>

  <% if Current.user %>
    <%= render PopupMenuComponent.new(
      button_content: render(AvatarComponent.new(user: Current.user, size: 32, classes: 'nav-avatar avatar')),
      menu_id: 'user-menu',
      align: :right
    ) do %>
      <div><%= button_to t('users.profile'), main_app.user_path(Current.user), class: 'popup-menu-item', method: :get %></div>

      <div><%= button_to t('app.sign_out'), main_app.session_path, method: :delete %></div>
    <% end %>
  <% end %>
</nav>

<div id="plans-list-area" style="display:none;">
  <%= render PlansTimelineComponent.new(plans: Plan.none) %>
</div>

<div id="inbox-panel" class="slide-panel">
  <div class="inbox-panel-header">
    <button id="close-inbox" type="button">&times;</button>
    <label><input type="checkbox" id="toggle-inbox-read"> <%= t('inbox.show_read') %></label>
  </div>
  <div id="inbox-list" data-loading-text="<%= t('app.loading') %>" data-empty-text="<%= t('inbox.no_messages') %>"></div>
</div>

<div id="creative-guide-popover" style="display:none; position:fixed; top:60px; left:50%; transform:translateX(-50%); background:white; border:1px solid var(--color-border); box-shadow:0 2px 8px rgba(0,0,0,0.12); padding:1.2em; max-width:400px; z-index:1000; border-radius:8px;">
  <span style="float:right; cursor:pointer; font-weight:bold;" id="close-creative-guide">&times;</span>
  <div style="margin-top:0.5em; color:#444; font-size:1em; line-height:1.5;">
    <%= t('app.creative_guide') %>
  </div>
</div>
